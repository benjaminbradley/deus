<div id="voting"></div>
<script type="text/javascript" src="/plugin/cue/js/stages.js">
</script>
<script type="text/javascript" src="/plugin/cue/js/ouroboros.js">
</script>
<script>
  var cues = ['hesiodwhisper','hesiodwhisper'];
  var ouroborus;
  function render() {
    $('.help').hide();

    var canvas = document.getElementById("cue-canvas");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    var stage = new createjs.Stage("cue-canvas");
    stage.autoClear = true;
    ouroborus = new deus.ouroboros.Ouroboros(cues); 
    var elements = [
      ouroborus,
    ];
    var i;
    for(i = 0; i < elements.length; i++) {
      elements[i].add(stage);  
    }
    ouroborus.enbiggen();
    
    createjs.Ticker.addEventListener("tick", handleTick);
    function handleTick(event) {
      for(i = 0; i < elements.length; i++) {
        elements[i].draw(stage);  
      }
      stage.update();
    }
  }


  $('#voting').html('');
  $('#cue-canvas').html('');

  createjs.Sound.registerSound("/plugin/cue/2/yes.mp3", "yes");
  createjs.Sound.registerSound("/plugin/cue/2/no.mp3", "no");



  var votes = {
    x: 0,
    y: 0
  };
  var socket = io.connect();
  socket.on('vote', function(data) {
    ouroborus.saveVotes(data);
  });

  socket.on('/cue/winner', function(data) {
    if (data.x > data.y) {
      ouroborus.filter([
	new createjs.ColorFilter(5,0,0,1, 0,0,255,0)
      ]);
      return;
    } else {
      ouroborus.filter([
	new createjs.ColorFilter(1,5,1,1, 0,0,255,0)
      ]);
    }
    ouroborus.setNext('clytemnestra');
  });

  $.get("/e/aesaratemplate", function(response) {
    $('#voting').html(response);
    render();
  });
</script>
